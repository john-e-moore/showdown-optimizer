<!-- d3573a77-04f2-4642-a803-a2bdc9888b75 f4706fed-badb-4729-826e-ed7a50afd7fd -->
# Fix duplicated FLEX players in filled DKEntries CSV

## Diagnosis

- The filled DKEntries file currently shows **CPT correct, but all five FLEX columns identical per lineup**, e.g. row 2 has `Tyrone Tracy Jr. (CPT)` and `Rhamondre Stevenson` in all FLEX spots.
- In [`src/fill_dkentries.py`](src/fill_dkentries.py), `_get_lineup_slot_columns` returns column *labels* starting at `'CPT'`, giving `['CPT', 'FLEX', 'FLEX', 'FLEX', 'FLEX', 'FLEX']` for the DKEntries template header.
- `_apply_assignments_to_dkentries` then writes using `result.at[row_idx, col] `with these labels; because pandas allows **duplicate column names**, assigning to `'FLEX'` updates **all FLEX columns at once**, and the last FLEX player written for a lineup overwrites the previous ones, producing five copies of that player.
- The diversified lineups themselves (`Lineups_Diversified` sheet) are likely correct; the bug lies in how we map `LineupRecord.players` into the DKEntries DataFrame when column names are duplicated.

## Implementation plan

- **Step 1: Change slot selection to use column positions instead of labels**
- Update `_get_lineup_slot_columns` to return the **integer column indices** for the six lineup slots (CPT + 5 FLEX) rather than the string labels, e.g. `[4, 5, 6, 7, 8, 9]` for the current DKEntries template.
- Optionally keep a small helper or comment documenting that these indices correspond to the original `['CPT', 'FLEX', 'FLEX', 'FLEX', 'FLEX', 'FLEX']` columns in the template header.
- **Step 2: Write lineups using positional assignment**
- Change `_apply_assignments_to_dkentries` to accept a sequence of **column indices** instead of labels, and inside the loop use `result.iat[row_idx, col_idx] = formatted` so each FLEX slot is updated independently even when the header names are duplicated.
- Ensure `assignment` keys (`row_idx`) are compatible with positional indexing (they already come from the DataFrameâ€™s default RangeIndex, so no additional changes should be needed).
- **Step 3: Wire changes and keep external behavior identical**
- In `run()` in `fill_dkentries.py`, update the call from `slot_cols = _get_lineup_slot_columns(dk_df)` to reflect that we now pass slot indices into `_apply_assignments_to_dkentries`.
- Confirm that the CSV header row written by `filled_df.to_csv` remains unchanged (still `CPT,FLEX,FLEX,FLEX,FLEX,FLEX,...`) so the output stays DK-compatible.
- **Step 4: Validate end-to-end**
- Re-run `python -m src.fill_dkentries` against the current `DKEntries (23).csv` and inspect the resulting CSV to confirm each lineup has **CPT + five distinct FLEX players** that match the `Lineups_Diversified` workbook.
- Optionally spot-check a few lineups against `top1pct_diversified_*.xlsx` to verify that names and roles (CPT vs FLEX) map to the correct DK IDs using the embedded Name/ID/Roster Position dictionary.

### To-dos

- [ ] Change `_get_lineup_slot_columns` in `src/fill_dkentries.py` to return integer column indices for CPT + 5 FLEX slots instead of duplicate string labels.
- [ ] Update `_apply_assignments_to_dkentries` and its call site so it uses positional indexing (`iat`) with the slot indices to write CPT and each FLEX independently.
- [ ] Re-run the DKEntries filling step and verify in the written CSV that each lineup has the correct CPT and five distinct FLEX players that match `Lineups_Diversified`.
- [ ] Compare the current `DKEntries_filled_*.csv` with the DK template and diversified lineups to ensure the diagnosis (duplicate FLEX labels causing overwrites) matches the observed duplication pattern.