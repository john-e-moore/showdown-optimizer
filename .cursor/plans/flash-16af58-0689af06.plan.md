<!-- 0689af06-e058-4b4d-8a96-c09697aa0967 9348d4ab-82ee-492d-bb85-7ee9ec30cda3 -->
## Plan to implement DraftKings-style tie splitting in Sim ROI

- **Identify tie-splitting insertion point**: Work in `_compute_sim_roi` in `src/flashback_sim.py`, which currently ranks lineups per simulation with `np.argsort(-scores, axis=1)` and directly indexes into `payouts_full` by rank to get a payout per lineup.
- **Design DK tie algorithm per simulation**:
- For each simulation row, use the existing sorted indices (`order`) and corresponding sorted scores to detect contiguous groups of equal scores (ties), at least for exact duplicates (identical lineups will have identical scores).
- For each tie group occupying ranks `[start_rank, end_rank]` (0-based indices), compute the average payout:
  - `avg_payout = payouts_full[start_rank : end_rank + 1].mean()`; if the group extends beyond the length of `payouts_full`, treat missing positions as zero.
- Assign `avg_payout` to **all** entries in that tie group for that simulation, producing a `payouts_this_sim` vector of length `num_lineups`.
- **Efficient implementation in `_compute_sim_roi`**:
- Replace the current direct indexing `payout_matrix = payouts_full[ranks] `with logic that, for each simulation row, builds `payouts_this_sim` via the tie grouping described above, then scatters those payouts back to the original lineup indices using `order`.
- Keep the function vectorized at the simulation level where possible (loop over sims, but inside each sim operate on NumPy arrays) to retain reasonable performance for large `num_sims` and `num_lineups`.
- Preserve the ROI definition `roi_matrix = (payout_matrix - entry_fee) / entry_fee` and the final mean across simulations.
- **Correctness and edge cases**:
- Verify that with no ties the behavior is unchanged (each lineup gets `payouts_full[rank]`).
- Validate a small synthetic example by hand: e.g., 2 lineups tied for first in a `[$100, $50, 0, ...]` structure both get `$75` in that simulation.
- Ensure behavior is well-defined when a tie group spans both paid and unpaid ranks, and when `payouts_full` has fewer elements than `num_lineups` (unpaid beyond the defined schedule).
- **Documentation note (optional)**:
- Optionally add a short note in the README flashback section that Sim ROI uses DK-style tie splitting on the payout curve (ties share the average payout of the tied rank span), for clarity and future reference.

### To-dos

- [ ] Review `_compute_sim_roi` in `src/flashback_sim.py` to confirm current rank-to-payout mapping and where to insert tie splitting.
- [ ] Modify `_compute_sim_roi` so that for each simulation it detects tied scores, averages the payouts across the tied rank span, and assigns that average payout to every entry in the tie group.
- [ ] Create or reason through small synthetic examples (including duplicated lineups) to verify that the new tie-splitting behavior matches DraftKings-style payout splitting and doesnâ€™t change non-tied cases.