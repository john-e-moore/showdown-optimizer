<!-- d3573a77-04f2-4642-a803-a2bdc9888b75 084ba3d6-5586-4465-b02d-7ce4f8d6c1ea -->
## Ownership summary CSV for filled DKEntries

### Goal

- Produce a new CSV under `outputs/dkentries/` that summarizes, for each player and role (CPT or FLEX): **player**, **team**, **role**, **field ownership** (from SaberSim projections), **lineup exposure** (fraction of DK entries using that player in that role), and **dollar exposure** (fraction of total entry fees on lineups using that player in that role).

### Data sources and shapes

- **Filled DK entries**: use the same DataFrame used to write `DKEntries_filled_*.csv` in [`src/fill_dkentries.py`](src/fill_dkentries.py):
- Columns: `Entry ID`, `Contest Name`, `Contest ID`, `Entry Fee`, `CPT`, 5×`FLEX`, plus trailing DK dictionary columns.
- From this we will derive:
- `lineup_exposure`: for each `(player, role)`, `100 * count(lineups where player is in that role) / N_entries`.
- `dollar_exposure`: for each `(player, role)`, `100 * sum(entry_fee of those lineups) / sum(all entry_fees)`.
- **Team + field ownership**:
- Reuse the existing SaberSim projections already materialized in the **correlation workbook** under `outputs/correlations/showdown_corr_matrix_*.xlsx`, using `_resolve_latest_excel` from [`src/top1pct_finish_rate.py`](src/top1pct_finish_rate.py).
- Read the `Sabersim_Projections` sheet (already used by `_load_corr_workbook`) to get per-player information:
- `Name` (player name, matching lineup/DK naming after stripping extras via `_parse_player_name`).
- `Team` / `TeamAbbrev` column for the `team` output.
- Ownership-related columns (e.g. CPT/FLEX or total `My Own`) to derive `field ownership` per role:
- Map to separate `field_own_cpt` and `field_own_flex` when those columns exist.
- If only aggregate ownership is present, document and use the same value for both roles or split as reasonable.

### Implementation steps

- **Step 1: Build internal exposure table from filled DK entries**
- Inside `fill_dkentries.py`, add a helper like `_compute_realized_exposure(dk_df: pd.DataFrame, slot_cols: Sequence[int]) -> Dict[Tuple[str, str], Tuple[float, float, int]]` that:
- Identifies valid entry rows using the same `entry_mask` as `_assign_lineups_fee_aware` (non-empty `Entry ID`).
- For each such row, reads the `Entry Fee` (as float) and the six lineup slots using positional indices in `slot_cols` (CPT/FLEX columns in the **filled** DataFrame).
- Extracts raw player names from the CPT/FLEX cells (stripping `" (player_id)"` using a small parser similar to `_parse_player_name`).
- Accumulates, per key `(player_name, role)`, both:
- `count_entries_with_player_role` and
- `sum_entry_fees_with_player_role`.
- After looping, converts these to percentages using:
- `lineup_exposure_pct = 100 * count / N_entries`.
- `dollar_exposure_pct = 100 * sum_entry_fees_with_player_role / total_entry_fees`.
- **Step 2: Build field ownership + team mapping from SaberSim projections**
- Add a helper in `fill_dkentries.py` that resolves the latest correlations workbook under `outputs/correlations/` (via `_resolve_latest_excel`) and reads the `Sabersim_Projections` sheet.
- From that DataFrame, construct a mapping keyed by player name (and, if needed, role) to:
- `team` (e.g. from `TeamAbbrev` or equivalent column).
- `field_own_cpt` and `field_own_flex`:
- Prefer explicit CPT/FLEX ownership columns if present.
- Otherwise, fall back to a single total ownership figure and either share it between roles or leave one role at 0.0 (to be decided based on column availability during implementation).
- Keep this mapping tolerant to missing players (default team = `""`, ownership = `0.0`).
- **Step 3: Join realized exposure with field ownership and write CSV**
- Create a function like `_write_ownership_summary_csv(filled_df, slot_cols, ownership_mapping, output_stem)` that:
- Iterates over all `(player_name, role)` pairs found in the realized exposure table.
- For each, looks up `team` and role-specific `field ownership` from the SaberSim mapping.
- Constructs a DataFrame with columns exactly: `player`, `team`, `role`, `field_ownership`, `lineup_exposure`, `dollar_exposure`.
- Sorts rows in a stable, readable order (e.g. by `role` (CPT before FLEX), then `player` ascending, or by `dollar_exposure` desc).
- Writes CSV to `outputs/dkentries/` with a filename derived from the same stem as the filled DKEntries file, e.g. `DKEntries_ownership_{stem}.csv` where `stem` comes from the diversified workbook (so it aligns with `DKEntries_filled_{stem}.csv`).
- **Step 4: Wire into the existing pipeline**
- In `run()` in `fill_dkentries.py`, after computing `filled_df` and before returning `output_path`:
- Call the new helper(s) to compute realized exposure from `filled_df` and `slot_cols`.
- Build/lookup the SaberSim ownership+team mapping from the latest correlation workbook.
- Call `_write_ownership_summary_csv(...)` to emit the ownership summary CSV alongside the filled DKEntries file.
- Keep the existing DKEntries filling behavior unchanged for callers (no new CLI flags required; the ownership summary is an additional sidecar output).

### To-dos

- [ ] Implement a helper in `src/fill_dkentries.py` that scans the filled DKEntries DataFrame and computes per-(player, role) lineup and dollar exposure percentages based on Entry Fee and the CPT/FLEX slots.
- [ ] Add a helper that loads the latest correlation workbook’s `Sabersim_Projections` sheet and builds a mapping from player (and role when available) to team and projected field ownership per role.
- [ ] Combine realized exposure with field ownership into a DataFrame with columns [player, team, role, field_ownership, lineup_exposure, dollar_exposure] and write it as `DKEntries_ownership_{stem}.csv` under `outputs/dkentries/`.
- [ ] Update the `run()` function in `src/fill_dkentries.py` to call the new helpers after writing the filled DKEntries CSV so the ownership summary is produced automatically each run.